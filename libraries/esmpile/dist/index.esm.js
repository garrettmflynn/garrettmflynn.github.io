var Ue=Object.defineProperty;var T=(t,e)=>{for(var s in e)Ue(t,s,{get:e[s],enumerable:!0})};var b={};T(b,{absolute:()=>y,base:()=>H,extension:()=>m,get:()=>u,noBase:()=>x,pathId:()=>B,url:()=>j});var w="application/javascript",q=t=>!t||t==="application/javascript",L={js:w,mjs:w,cjs:w,ts:"text/typescript",json:"application/json",html:"text/html",css:"text/css",txt:"text/plain",svg:"image/svg+xml",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",webp:"image/webp",mp3:"audio/mpeg",mp4:"video/mp4",webm:"video/webm",ogg:"application/ogg",wav:"audio/wav"},$=t=>L[t];var U={nodeModules:{nodeModules:"node_modules",relativeTo:"./"}};var M="://",u=(t,e="",s=!1,i=!1)=>{if(j(t))return t;let o="",n=c=>(o=c.includes(M)?c.split(M).splice(0,1):void 0,o?c.replace(`${o}${M}`,""):c);t.includes(M)&&(t=n(t)),e.includes(M)&&(e=n(e)),s||(e=e.split("/").filter(c=>c!="..").join("/")),e[e.length-1]==="/"&&(e=e.slice(0,-1));let r=e.split("/");if(r.length===1&&r[0]===""&&(r=[]),!i){let c=r.pop();if(c){let d=c.split(".");(d.length==1||d.length>1&&d.includes(""))&&r.push(c)}}let f=t.split("/").filter((c,d)=>!!c).filter((c,d)=>c===".."?(r.pop(),!1):c!=="."),p=[...r,...f].join("/");return o?o+"://"+p:p};function y(t,e){let s=t[0]!==".",i=j(t);return s&&(e||!i)}function j(t){try{return new URL(t),!0}catch{return!1}}var m=t=>{let e=t.split("/").slice(-1)[0].split(".").slice(-1)[0];if(L[e])return e},H=t=>t.substring(0,t.lastIndexOf("/")),x=(t,e,s)=>{t=globalThis.location?t.replace(`${H(globalThis.location.href)}/`,"./"):t;let i=y(t,!0),o=e.relativeTo??U.nodeModules.relativeTo,n=e.nodeModules??U.nodeModules.nodeModules;if(i)return t;{let r=t;return s&&(r=r.replace(`${n}/`,"")),r=r.replace(`${o.split("/").slice(0,-1).join("/")}/`,""),r[0]!=="."&&(r=`./${r}`),r}},B=(t,e)=>u(x(t,e));var N={};T(N,{getMainPath:()=>Z,path:()=>k,resolve:()=>Q,transformation:()=>E});var k=t=>{let e=t.nodeModules??U.nodeModules.nodeModules,s=t.relativeTo??U.nodeModules.relativeTo;return u(e,s)},Q=async(t,e)=>{let s=k(e),i=t.split("/"),o=u(t,s);if(i.length>1){if(m(o))return o;o+="/package.json"}return await Z(t,o,e).catch(n=>{console.warn(`${o} does not exist or is not at the root of the project.`)})},X=(t,e,s)=>u(t,s,!1,e.split("/").length===1),Me=(t,e=t)=>X("package.json",t,e),Z=async(t,e=t,s={})=>{let i=await je(t,e,s);if(!i)return e;let o=i.module||i.main||"index.js";return X(o,t,e)},je=async(t,e=t,s)=>{let i=Me(t,e);return(await import(j(i)?i:new URL(i,window.location.href).href,{assert:{type:"json"}})).default},E={name:"node_modules",handler:Q};var F={};T(F,{get:()=>C});var te=["ts","js"],ee=[null,...te,E],se=t=>{let e=m(t),s=y(t),i=s?t.split("/").length===1:!1,o=!e;if(!i&&s&&o){let n=te.map(r=>({extension:r,name:`${E.name} + ${r}`,handler:E.handler}));return t.split("/").length===1?[E,t,...n]:[t,...n,E]}else return s?[...ee].reverse():o?[...ee]:[]};var Se="was not resolved locally. You can provide a direct reference to use in",R=(t,e=t)=>new Error(`${t} ${Se} options.filesystem._fallbacks['${e}'].`);var ie=(t,e="js")=>{let s=y(t),i=t.split("/"),o=m(t);return(!s||s&&i.length>1)&&!o?`${t}.${e}`:t},ne=async(t,e,s,i)=>{if(!e)return t;let o=typeof e;if(o==="string"&&(!i||i==="string"))return ie(t,e);if(o==="object"&&(!i||i==="object"))return e.extension&&(t=ie(t,e.extension)),await e.handler(t,s).catch(n=>{throw R(t,x(t,s))})};var Be=t=>{let e;try{e=new URL(t).href}catch{e=u(t,globalThis.location.href)}return e},re=async(t,e={})=>{e.fetch||(e.fetch={}),e.fetch.mode||(e.fetch.mode="cors");let s=Be(t),i=e?.callbacks?.progress?.fetch,o=await ke(s,e,{path:t,progress:i});if(!o.buffer)throw new Error("No response received.");let n=o.type.split(";")[0];return{...o,url:s,type:n}},ke=async(t,e={},s)=>{let i=s.path??t,o=u(x(i,e)),n=await globalThis.fetch(t,e.fetch),r=0,a=[],l=0,f=typeof s.progress=="function",p=await new Promise(async d=>{if(n){l=parseInt(n.headers.get("Content-Length"),10);let h=n.headers.get("Content-Type");if(globalThis.REMOTEESM_NODE){let g=await n.arrayBuffer();d({buffer:g,type:h})}else{let g=n.body.getReader(),v=async({done:S,value:Y})=>{if(S){let G={};typeof h=="string"&&(G.type=h);let Te=await new Blob(a,G).arrayBuffer();d({buffer:new Uint8Array(Te),type:h});return}r+=Y.length;let _e=Y;return a.push(_e),f&&s.progress(o,r,l,null,null,n.headers.get("Range")),g.read().then(v)};g.read().then(v)}}else console.warn("Response not received!",e.headers),d(void 0)}),c={response:n,...p};if(f){let d=[null,null];n.ok?d[0]=c:d[1]=c,s.progress(o,r,l,...d,n.headers.get("Range"))}return c};var ae=new TextDecoder("utf-8"),O=async(t,e,s)=>{let i={uri:t,text:{original:"",updated:""},buffer:null};if(globalThis.REMOTEESM_NODE){let o=t.replace("file://","");i.buffer=globalThis.fs.readFileSync(o),i.text.original=i.text.updated=ae.decode(i.buffer)}else{let o=await re(t,e),n=o.response;if(i.response=n,n.ok){if(s){let r=n.headers.get("Content-Type");if(!r.includes(s))throw new Error(`Expected Content Type ${s} but received ${r} for  ${t}`)}i.buffer=o.buffer,i.text.original=i.text.updated=ae.decode(i.buffer)}else throw new Error(n.statusText)}return i},le=async(t,e,s)=>{let i=se(t),o;if(i.length>0){do{let n=i.shift(),r=n?.name??n,a=c=>{e.debug&&console.error(`Import using ${r??n} transformation failed for ${t}`)},l=await ne(t,n,e),f=u(l,e.relativeTo);o=await s(f,e,n?null:"application/javascript").then(c=>(e.debug&&console.warn(`Import using ${r??n} transformation succeeded for ${t}`),c)).catch(a)}while(!o&&i.length>0);if(!o)throw new Error(`No valid transformation found for ${t}`)}else o=await s(u(t,e.relativeTo),e);return o},ce=async(t,e)=>{let i=m(t)==="json",o={};return await le(t,e,async n=>{o.uri=n,o.result=await(i?import(n,{assert:{type:"json"}}):import(n))}),o},de=async(t,e)=>await le(t,e,O);var Re=/\/\/# sourceMappingURL=(.*\.map)/,C=async(t,e,s,i=!0)=>{if(s||(s=(await O(t,e)).text.original),s){let o=s.match(Re);if(o){let n=async()=>{let r=u(o[1],t),l=(await O(r,e)).text.original;l.slice(0,3)===")]}"&&(console.warn("Removing source map invalidation characters"),l=l.substring(l.indexOf(`
`)));let f={result:JSON.parse(l)};return f.text={original:l,updated:null},f};return i?n():n}}};var J={};T(J,{script:()=>A});var A=async t=>await new Promise((e,s)=>{let i=document.createElement("script"),o=!1;i.onload=i.onreadystatechange=function(){!o&&(!this.readyState||this.readyState=="complete")&&(o=!0,e(window))},i.onerror=s,i.src=t,document.body.insertAdjacentElement("beforeend",i)});var Ee={};T(Ee,{default:()=>_,get:()=>I});var K={};T(K,{datauri:()=>Le,objecturl:()=>De});function Oe(t){let e="",s=new Uint8Array(t),i=s.byteLength;for(let o=0;o<i;o++)e+=String.fromCharCode(s[o]);return window.btoa(e)}var pe=(t,e=w,s=!1)=>{let o=(typeof t=="string"?"text":"buffer")==="buffer"?Oe(t):btoa(s?unescape(encodeURIComponent(t)):t);return`data:${e};base64,`+o};function ue(t,e=w){typeof t=="string"&&(t=new TextEncoder().encode(t));let s=new Blob([t],{type:e});return URL.createObjectURL(s)}var Le=async(...t)=>await he(pe,...t),De=async(...t)=>await he(ue,...t),Ne=async(t,e)=>await(e?import(t,{assert:{type:"json"}}):import(t)).catch(s=>{throw s});async function he(t,e,s,i){let o,n;if(!i){let a=m(s);i=$(a)}let r=i==="application/json";try{o=t(e,i),n=await Ne(o,r)}catch(a){o=t(e,i,!0),q(i)?n=o=await Ce(o,a).catch(l=>{throw l}):n=o}return{encoded:o,module:n}}async function Ce(t,e){if(e.message.includes("The string to be encoded contains characters outside of the Latin1 range.")||e.message.includes("Cannot set properties of undefined"))return await A(t);throw e}var Fe={compilerOptions:{target:"ES2015",module:"ES2020",strict:!1,esModuleInterop:!0}},me=(t,e="text")=>{if(window.ts){let s=e!=="buffer"?t[e].updated:new TextDecoder().decode(t[e]);return t.text.updated=window.ts.transpile(s,Fe.compilerOptions),e==="buffer"?(t.buffer=new TextEncoder().encode(t.text.updated),t.buffer):t.text.updated}else throw new Error("Must load TypeScript extension to compile TypeScript files using remoteESM.load.script(...);")};var z,ge,be,Je=new Promise(async(t,e)=>{try{if(typeof process=="object"){if(z||(globalThis.REMOTEESM_NODE=!0,z=globalThis.fetch=(await import("node-fetch")).default,typeof globalThis.fetch!="function"&&(globalThis.fetch=z)),ge||(ge=globalThis.fs=(await import("fs")).default),!be){let s=(await import("node:buffer")).default;be=globalThis.Blob=s.Blob}t(!0)}else t(!0)}catch(s){e(s)}}),V=Je;var we="__esmpileSourceBundle";globalThis.REMOTEESM_BUNDLES||(globalThis.REMOTEESM_BUNDLES={global:{}});var P=globalThis.REMOTEESM_BUNDLES.global,W="No buffer or text to bundle for",xe=1e4,ze=(xe/1e3).toFixed(1),Ve=t=>`
export const ${we} = () => globalThis.REMOTEESM_BUNDLES["${t.collection}"]["${t.name}"];
`,We=/[^\n]*(?<![\/\/])(import)\s+([ \t]*(?:(?:\* (?:as .+))|(?:[^ \t\{\}]+[ \t]*,?)|(?:[ \t]*\{(?:[ \t]*[^ \t"'\{\}]+[ \t]*,?)+\}))[ \t]*)from[ \t]*(['"])([^'"\n]+)(?:['"])([ \t]*assert[ \t]*{[ \n\t]*type:[ \n\t]*(['"])([^'"\n]+)(?:['"])[\n\t]*})?;?/gm;function I(t,e=this.options){let s=t?B(t,e):void 0,i=globalThis.REMOTEESM_BUNDLES[e.collection];i||(i=globalThis.REMOTEESM_BUNDLES[e.collection]={});let o=i[s];return o?e&&(o.options=e):o=new _(t,e),o}var ye={resolve:void 0,reject:void 0,promise:void 0},_=class{filename="bundle.esmpile.js";promises={encoded:Object.assign({},ye),result:Object.assign({},ye)};uri;#t;get url(){return this.#t}set url(e){let s=this.options._esmpile;s.entrypoint||(s.entrypoint=this),this.uri||(this.uri=e),!y(e,!0)&&!e.includes(this.#e.relativeTo)&&(e=u(e,this.#e.relativeTo)),this.#t=e;let o=B(this.url,this.options);this.name!==o&&(this.name=o),this.updateCollection(this.options.collection)}status=null;#e;get options(){return this.#e}set options(e={}){e._esmpile||(e._esmpile=this.#e?._esmpile??{circular:new Set}),e.collection||(e.collection=this.#e?.collection),this.#e=e,e.output||(e.output={}),this.bundler=e.bundler,this.updateCollection(this.options.collection),typeof e?.callbacks?.progress?.file=="function"&&(this.callbacks.file=e.callbacks.progress.file),e.fetch||(e.fetch={}),e.fetch=Object.assign({},e.fetch),e.fetch.signal=this.controller.signal}controller=new AbortController;#s;get bundler(){return this.#s}set bundler(e){this.setBundleInfo(e),this.setBundler(e,!1)}setBundleInfo=e=>{this.#e._esmpile.lastBundler=this.#s,this.#s=this.#e.bundler=e;let s=this.#e.output;e&&(s[e]=!0,s.text=!0),this.derived.compile=!this.#e.forceNativeImport&&(s.text||s.datauri||s.objecturl)};setBundler=async(e,s=!0)=>{s&&this.setBundleInfo(e);let i=this.#e._esmpile,o=i.lastBundle,n=i.lastBundle===e;if(!n||i.lastBundle&&n&&!o){let r=i.entrypoint;if(e){let l=Array.from(this.dependencies.entries());l.length&&await Promise.all(l.map(async([f,p])=>{p.bundler=e,await p.result}))}["success","failed"].includes(r?.status)&&(e?o?this.encoded=await this.bundle(o):this.result=await this.resolve():this.result=await this.resolve())}};#o;get name(){return this.#o}set name(e){if(e!==this.#o){let s=globalThis.REMOTEESM_BUNDLES[this.collection];s&&(P[this.name]===s[this.name]&&delete P[this.name],delete s[this.name]),this.#o=e;let o=e.split("/").pop().split(".");this.filename=[...o.slice(0,-1),"esmpile","js"].join("."),P[this.name]?this.options.collection!="global"&&console.warn(`Duplicating global bundle (${this.name})`,this.name):P[this.name]=this}}#n;get collection(){return this.#n}set collection(e){this.#n=e;let s=globalThis.REMOTEESM_BUNDLES[e];s||(s=globalThis.REMOTEESM_BUNDLES[e]={}),this.name&&(s[this.name]?s[this.name]!==this&&console.warn(`Trying to duplicate bundle in bundle ${e} (${this.name})`,this.name):s[this.name]=this)}#r;#i;get text(){return this.#r??this.info.text.original}set text(e){this.#r=e,this.encoded=this.bundle("text").catch(s=>{if(!s.message.includes(W))throw s})}set buffer(e){this.#i=e,this.encoded=this.bundle("buffer").catch(s=>{if(!s.message.includes(W))throw s})}dependencies=new Map;dependents=new Map;get entries(){let e=[],s=i=>{i.dependencies.forEach(o=>{!e.includes(o)&&o!==this&&(e.push(o),s(o))})};return s(this),e}encodings={};info={};imports=[];link=void 0;result=void 0;callbacks={file:void 0};derived={compile:!1,dependencies:{n:0,resolved:0}};constructor(e,s={}){this.options=s,this.url=e}import=async()=>{this.status="importing";let e=await ce(this.url,this.options);if(e?.result)return e.result;this.status="fallback"};get=I;compile=async()=>{this.status="compiling",await V;try{let e=await de(this.url,this.options).catch(s=>{throw s});try{e&&(this.info=e,this.url=this.info.uri,this.buffer=this.info.buffer,await this.encoded)}catch{this.imports={};let i=[];Array.from(this.info.text.updated.matchAll(We)).forEach(([r,a,l,f,p])=>{if(p){let c=!!l.match(/\*\s+as/),d=l.replace(/\*\s+as/,"").trim(),g=y(p)?p:u(p,this.url),v=k(this.options);g=g.replace(`${v}/`,"");let S={name:g,path:p,prefix:a,variables:d,wildcard:c,current:{line:r,path:p},original:r,counter:0,bundle:null};this.imports[g]||(this.imports[g]=[]),this.imports[g].push(S),i.push(S)}}),this.derived.dependencies.resolved=0,this.derived.dependencies.n=this.imports.length;let n=i.map(async(r,a)=>{await this.setImport(r,a),this.derived.dependencies.resolved++});await Promise.all(n),this.text=this.info.text.updated}}catch(e){throw e}return await this.encoded,this.result};updateImport=(e,s)=>{if(s===e.current.path)return;let{prefix:i,variables:o,wildcard:n,bundle:r}=e,a="";if(typeof s=="string")a=`${i} ${n?"* as ":""}${o} from "${s}"; // Imported from ${r.name}

`;else{let f=o.replace("{","").replace("}","")===o,p=o.replace("{","").replace("}","").split(",").map(d=>d.trim()),c=d=>{let h="";n||(f?h=".default":h=`.${d}`),a+=`${i==="import"?"":"export "}const ${d} = (await globalThis.REMOTEESM_BUNDLES["${r.collection}"]["${r.name}"].result)${h};

`};p.forEach(c)}this.info.text.updated=this.info.text.updated.replace(e.current.line,a),e.current.line=a,e.current.path=s};setImport=async e=>{let s=e.path,i=e.name,o=this.get(i);if(e.bundle=o,this.addDependency(o),o.status){let r=!1;setTimeout(()=>{r||(console.error(`Took too long (${ze}s)...`,o.uri),o.promises.result.reject(),o.promises.encoded.reject())},xe),await o.result,r=!0}else{let r={output:{},...this.options};r.output.text=!0,await(await this.get(i,r)).resolve(s)}let n=await o.encoded;return this.updateImport(e,n),o};notify=(e,s)=>{let i=e!==void 0,o=s!==void 0;this.callbacks.file&&this.callbacks.file(this.name,this.derived.dependencies.resolved,this.derived.dependencies.n,i?this:void 0,o?s:void 0)};get buffer(){return this.#i}bundle=(e="buffer")=>{let s=e==="text";return this.options._esmpile.lastBundle=e,this.promises.encoded.promise=new Promise(async(i,o)=>{this.promises.encoded.resolve=i,this.promises.encoded.reject=o;try{let n=s?this.info.text.updated:this.buffer;n||(this.info.fallback?this.encoded=this.info.fallback:o(new Error(`${W} ${this.name}`)));let r=m(this.url),a=$(r);switch(a){case"text/typescript":n=me(this.info,e),a=w;break}if(a===w){let c=Ve(this),d=n;s||(d=new TextDecoder().decode(n)),!d.includes(c)&&(d+=c,this.info.text.updated=d),s||(this.#i=n=new TextEncoder().encode(d))}let l=[],f=this.options.output;f?.datauri&&l.push("datauri"),f?.objecturl&&l.push("objecturl");for(let c in l){let d=l[c],h=await K[d](n,this.url,a);h&&(this.result=h.module,this.encodings[d]=await h.encoded)}let p=this.bundler==="objecturl"?this.encodings.objecturl:this.encodings.datauri;i(p)}catch(n){o(n)}}),this.promises.encoded.promise};delete=()=>{this.objecturl&&window.URL.revokeObjectURL(this.objecturl)};addDependency=e=>{let s=!1;this.dependents.has(e.url)&&(s=!0),this.dependencies.set(e.url,e),e.dependencies.has(this.url)&&(s=!0),e.dependents.set(this.url,this),s&&(this.circular(e),e.circular(this))};removeDependency=e=>{this.dependencies.delete(e.name),e.dependents.delete(this.name)};updateDependency=async(e,s)=>{this.imports[e.url].forEach(o=>this.updateImport(o,s))};updateCollection=e=>{e?this.collection=e:this.collection=this.options.collection=Object.keys(globalThis.REMOTEESM_BUNDLES).length};download=async(e=this.filename)=>{this.bundler!="datauri"&&await this.setBundler("datauri");let s=this.encodings.datauri.split(",")[0].split(":")[1].split(";")[0],i=atob(this.encodings.datauri.split(",")[1]),o=[];for(var n=0;n<i.length;n++)o.push(i.charCodeAt(n));let r=new Uint8Array(o),a=new Blob([r],{type:s}),l=URL.createObjectURL(a);if(globalThis.REMOTEESM_NODE)await V,globalThis.fs.writeFileSync(e,r),console.log(`Wrote bundle contents to ${e}`);else{var f=document.createElement("a");document.body.appendChild(f),f.style="display: none",f.href=l,f.download=e,f.click()}};circular=async e=>{this.options._esmpile.circular.add(this.url);let s=await this.resolve().catch(i=>{console.warn(`Circular dependency detected: Fallback to direct import for ${this.url} failed...`,i);let o=`Circular dependency cannot be resolved: ${this.uri} <-> ${e.uri}.`;throw new Error(o)});console.warn(`Circular dependency detected: Fallback to direct import for ${this.url} was successful!`,s)};resolve=async(e=this.uri)=>(this.status="resolving",this.result=void 0,this.encoded=void 0,this.result=this.promises.result.promise=new Promise(async(s,i)=>{this.promises.result.reject=i,this.promises.result.resolve=s;let o,n=this.options._esmpile.circular.has(this.url),r=n||!this.derived.compile;try{o=r?await this.import().catch(async a=>{if(this.#e.fallback===!1)throw a;await this.setBundler("objecturl")}):void 0;try{if(!o){if(n)throw new Error(`Failed to import ${this.url} natively.`);o=await this.compile()}}catch(a){if(a){if(this.options.fetch?.signal?.aborted)throw a;{let l=y(e)?x(e,this.options,!0):x(this.url,this.options,!0);console.warn(`Failed to fetch ${e}. Checking filesystem references...`);let f=this.options.filesystem?._fallbacks?.[l];if(f)throw console.warn(`Got fallback reference (module only) for ${e}.`),o=f,new Error("Fallbacks are broken...");{let p="was not resolved locally. You can provide a direct reference to use in";throw a.message.includes(p)?a:R(e,l)}}}}await this.encoded,this.status="success",this.notify(this),s(o)}catch(a){this.status="failed",this.notify(null,a),i(a)}}),this.result);sources=async()=>await C(this.#t,this.#e,this.info.text.original)};var rt=u,at=b,lt=_,Ye=async(t,e={})=>{e=Object.assign({},e);let s=I(t,e);return await s.resolve(),s.result},ct=Ye;export{lt as Bundle,Ee as bundle,Ye as compile,ct as default,J as load,N as nodeModules,at as path,rt as resolve,F as sourceMap};
//# sourceMappingURL=index.esm.js.map
